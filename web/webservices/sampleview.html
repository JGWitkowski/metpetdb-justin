{% extends "base.html" %}

{% block title %}
  <h3>Sample {{sample.attributes.id}}</h3>
{% endblock %}

{%block main%}
   
    <table id="sampleview_table" class="table">
       
        <tbody>
            <tr>
                <td class="sample_label">Owner</td>
                <td class="sample_value">{{sample.attributes.owner_name}}</td>
            </tr>
            <tr>
                <td class="sample_label">IGSN</td>
                <td class="sample_value">{{sample.attributes.number}}</td>
            </tr>
            <tr>
                <td class="sample_label">Aliases</td>
                <td class="sample_value">{% for alias in sample.attributes.aliases%} {{alias.name}}, {%endfor%}</td>
            </tr>
            <tr>
                <td class="sample_label">Date Collected</td>
                <td class="sample_value">{{sample.attributes.collection_date}}</td>
            </tr>
            <tr>
                <td class="sample_label">Rock Type</td>
                <td class="sample_value">{{sample.attributes.rock_type_name}}</td>
            </tr>
            <tr>
                <td class="sample_label">Public</td>
                <td class="sample_value">{{sample.attributes.public_data}}</td>
            </tr>
            <tr>
                <td class="sample_label">Longitude</td>
                <td class="sample_value">{{sample.attributes.longitude}}</td>
            </tr>
            <tr>
                <td class="sample_label">Latitude</td>
                <td class="sample_value">{{sample.attributes.latitude}}</td>
            </tr>
            <tr>
                <td class="sample_label">Country</td>
                <td class="sample_value">{{sample.attributes.country}}</td>
            </tr>
            <tr>
                <td class="sample_label">Collector</td>
                <td class="sample_value">{{sample.attributes.collector}}</td>
            </tr>
            <tr>
                <td class="sample_label">Present Sample Location</td>
                <td class="sample_value">{{sample.attributes.location_text}}</td>
            </tr>
            <tr>
                <td class="sample_label">Region</td>
                <td class="sample_value">{% for region in sample.attributes.regions%}{{region.name}}, {%endfor%}</td>
            </tr>
            <tr>
                <td class="sample_label">Metamorphic Region</td>
                <td class="sample_value">{% for metamorphic_region in sample.attributes.metamorphic_regions%}{{metamorphic_region.name}}, {%endfor%}</td>
            </tr>
            <tr>
                <td class="sample_label">Metamorphic Grade</td>
                <td class="sample_value">{% for metamorphic_grade in sample.attributes.metamorphic_grades%}{{metamorphic_grade.name}}, {%endfor%}</td>
            </tr>
            <tr>
                <td class="sample_label">Publication References</td>
                <td class="sample_value">{% for reference in references%} {{reference.name}}, {%endfor%}</td>
            </tr>
            <tr>
                <td class="sample_label">Abstracts</td>
                <td class="sample_value">Don't know yet</td>
            </tr>
            <tr>
                <td class="sample_label">Minerals</td>
                <td class="sample_value">{% for mineral in sample.attributes.minerals%} {{mineral.name}},  {%endfor%}</td>
            </tr>
            <tr>
                <td class="sample_label">Count</td>
                <td class="sample_value">{{sample.attributes.subsamples_count}}</td>
            </tr>
        </tbody>
    </table>


    <div id="map_canvas"></div>
    <hr>
               
    <!-- adding image link from metpetdbweb -->
    <div id="sampleview_images">
        <h4 id="s_images">Sample Images</h4>
        <table id="image_canvas" class="table">
            <thead>
                <tr>
                    <th>Thumbnail</td>
                    <th>Type</td>
                </tr>
            </thead>
            <tbody>
                {% for image in sample.attributes.images%}
                <tr id="thumb_row">
                    <td><!-- URLs pointing to the current petdb server where image files are located, cant make this generic -->
                        <a href="http://metpetdb.rpi.edu/metpetweb/image/?checksum={{image.checksum_half}}" {{image.checksum_half}}>
                            <img src="http://metpetdb.rpi.edu/metpetweb/image/?checksum={{image.checksum_64x64}}" {{image.checksum_64x64}}/>
                        </a>
                    </td>
                    <td>{{image.image_type}}</td>
                </tr>   
                {%endfor%}
            </tbody>
        </table>
    </div>

   
    <hr>
    <h4 id="subsampletable_header">Subsamples</h4>
    <table id="subsampletable_canvas">
        <thead>
            <tr>
                <th>Name</th>
                <th>Public</th>
                <th>Type</th>
                <th>Image Count</th>
                <th>Chemical analysis Count</th>
                <th>Owner</th>
                <th>Image Map</th>
            </tr>
        </thead>
        <tbody>
            {%for subsample in subsamples%}
            <tr>
                <!-- The link to subsample needs to be updated to named URL+ generic views type -->
                <td id="img-popup"><a href="{% url subsample subsample.id %}" target="_blank">{{subsample.name}}</td>
                <td>{{subsample.public}}</td>
                <td>{{subsample.type}}</td>
                <td>{{subsample.image_count}}</td>
                <td>{{subsample.chemical_analysis_count}}</td>
                <td>{{subsample.owner_name}}</td>
                <td> dont know yet</td>
            </tr>
            {%endfor%}
        </tbody>
    </table>


<!--------------------- JS for Page elements ------------------------------------------------------------------------>


<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>
<script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
    //images open in a pop up window on click
   
   
    console.log({{sample.attributes.latitude}}+','+{{sample.attributes.longitude}});
   
    $(document).ready(function() {
        console.log('enter table code');
        $('#subsampletable_canvas').dataTable();

        $('#thumb_row td a').lightBox();   //lightbox code

       // $('#tej_close').css({"font-size": "15px", "color": "red", "text-decoration":"none"}); -->need to figure out how to serve static files in django - jquery.lightbox-0.5.css
    } );

    //google map api
    map_lat = {{sample.attributes.latitude}};
    map_long = {{sample.attributes.longitude}};
    console.log(map_lat, map_long);

    var myCenter=new google.maps.LatLng(map_lat, map_long);
    function initialize()
    {
        var mapProp =
        {
          center:myCenter,
          zoom:8,
          mapTypeId:google.maps.MapTypeId.ROADMAP
        };

        var map=new google.maps.Map(document.getElementById("map_canvas"), mapProp);
        var infowindow = new google.maps.InfoWindow();

        var marker=new google.maps.Marker({
          position:myCenter,
        });

        var content="latitude:"+map_lat+","+"longitude:"+map_long;
        console.log(content);
       
        makeInfoWindowEvent(map, infowindow, content, marker);


        marker.setMap(map);

        function makeInfoWindowEvent(map, infowindow, contentString, marker) {
            google.maps.event.addListener(marker, 'click', function() {

              infowindow.setContent(contentString);
              infowindow.open(map, marker);
            })};
    }

    google.maps.event.addDomListener(window, 'load', initialize);
   
</script>
{%endblock%}